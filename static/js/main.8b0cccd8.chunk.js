(this["webpackJsonpcar-wash-calendar"]=this["webpackJsonpcar-wash-calendar"]||[]).push([[0],{128:function(e,t,c){},133:function(e,t,c){"use strict";c.r(t);var a=c(0),s=c(104),n=(c(128),c(18)),d=c.n(n),l=c.p+"static/media/car-wash.8b2ec219.gif",r=c.p+"static/media/car-wash.83a6d6f4.png",i=c(141),o=c(148),j=c(145),b=c(147),h=c(143),m=c(146),O=c(114),u=c(36);c(134);const f=Object(O.a)({apiKey:"AIzaSyBLnjz1nTXh_fR9CBRW4CahMtalbvwLupc",authDomain:"car-wash-group.firebaseapp.com",projectId:"car-wash-group",storageBucket:"car-wash-group.appspot.com",messagingSenderId:"264083815693",appId:"1:264083815693:web:624db999c2368ace6e4444",measurementId:"G-0RYWCPLE1X"});var x=Object(u.d)(f),p=c(142),v=c(98),y=c(150),g=c(151),Y=c(152),M=c(149),w=c(3);var D=e=>{let{loading:t,handleClick:c,todayStatus:a}=e;const s=void 0===a?null:a.status,n={items:[{label:"\u4f1a\u53bb\u6d17",key:"\u4f1a\u53bb\u6d17",disabled:"\u4f1a\u53bb\u6d17"===s},{label:"\u6d17\u8fc7\u4e86",key:"\u6d17\u8fc7\u4e86",disabled:"\u6d17\u8fc7\u4e86"===s},{label:"\u4e0d\u6d17\u4e86",key:"\u4e0d\u6d17\u4e86",disabled:"\u4e0d\u6d17\u4e86"===s}],onClick:e=>{let{key:t,keyPath:a,domEvent:s}=e;c(t)}};return Object(w.jsx)(p.a,{menu:n,loading:t,trigger:["click"],children:Object(w.jsxs)(v.a,{type:s?"default":"primary",shape:"round",size:"large",children:["\u4f1a\u53bb\u6d17"===s&&Object(w.jsx)(y.a,{twoToneColor:"#0ca237"}),"\u6d17\u8fc7\u4e86"===s&&Object(w.jsx)(g.a,{}),"\u4e0d\u6d17\u4e86"===s&&Object(w.jsx)(Y.a,{twoToneColor:"#ff0000"}),"\u6211\u4eca\u5929",s||"...",Object(w.jsx)(M.a,{})]})})},S=c(144),k=c(153),C=c(154);var N=e=>{let{open:t,selection:c,handleRemoveSelection:a,handleSubmit:s,handleCancel:n}=e;const l=e=>{a(e)};return Object(w.jsx)(S.a,{offsetBottom:"0",children:Object(w.jsxs)(j.a,{align:"middle",id:"swap-container",justify:"center",className:t?"open":"",children:[Object(w.jsx)(b.a,{xs:6,children:Object(w.jsx)("div",{className:"slot from",children:c.from&&Object(w.jsxs)(m.a,{vertical:"vertical",justify:"center",align:"center",children:[Object(w.jsx)("div",{className:"date",children:d()(c.from.date).format("MMM DD, YYYY")}),Object(w.jsx)("div",{className:"person",children:c.from.person}),Object(w.jsx)(v.a,{danger:!0,size:"small",shape:"circle",icon:Object(w.jsx)(k.a,{}),onClick:()=>l(c.from)})]})})}),Object(w.jsx)(b.a,{xs:4,children:Object(w.jsx)(C.a,{style:{fontSize:"16px",color:"#08c"}})}),Object(w.jsx)(b.a,{xs:6,children:Object(w.jsx)("div",{className:"slot to",children:c.to&&Object(w.jsxs)(m.a,{vertical:"vertical",justify:"center",align:"center",children:[Object(w.jsx)("div",{className:"date",children:d()(c.to.date).format("MMM DD, YYYY")}),Object(w.jsx)("div",{className:"person",children:c.to.person}),Object(w.jsx)(v.a,{danger:!0,size:"small",shape:"circle",icon:Object(w.jsx)(k.a,{}),onClick:()=>l(c.to)})]})})}),Object(w.jsx)(b.a,{xs:6,children:Object(w.jsxs)(m.a,{gap:"large",vertical:"vertical",align:"flex-end",children:[Object(w.jsx)("div",{children:Object(w.jsx)(v.a,{type:"primary",disabled:null===c.from||null===c.to,onClick:()=>s(),children:"Save"})}),Object(w.jsx)("div",{children:Object(w.jsx)(v.a,{onClick:()=>n(),children:"Cancel"})})]})})]})})};const{Title:E}=i.a;function I(){const[e,t]=Object(a.useState)([]),[c,s]=Object(a.useState)(!1),[n,i]=Object(a.useState)([]),[O,f]=Object(a.useState)([]),[p,v]=Object(a.useState)({from:null,to:null}),y={start:d()("2023-12-07"),end:d()("2024-03-11")},g=async()=>{try{const e=await Object(u.c)(Object(u.a)(x,"calendarMark")),c=[];e.forEach((e=>{c.push({id:e.id,...e.data()})}));const a=await Object(u.c)(Object(u.a)(x,"calendar")),s=[],n=a.docs[0].data().date;if(d()(n).startOf("week").isBefore(d()("2023-12-07")))for(let t=0;t<d()(n).day();t++){const e=d()(n).startOf("week");e.add(t,"days"),s.push({id:e.format("YYYYMMDD"),date:e.format("YYYY-MM-DD"),dayISO:e.format("ddd"),day:e.day(),person:""})}a.forEach((e=>{s.push({id:e.id,...e.data()})})),t(c),i(s)}catch(e){console.error("Error fetching data: ",e)}};Object(a.useEffect)((()=>{g()}),[]),Object(a.useEffect)((()=>{const e=[];let t=[];n.forEach((c=>{const a=d()(c.date),s={...c,dayISO:a.format("ddd"),day:a.day()};t.push(s),(6===s.day||d()(s.date).isSame(y.end))&&(e.push(t),t=[])})),f(e),v({from:null,to:null})}),[n]);const Y=t=>{if(!t.person||d()(t.date).isBefore(d()().add(-1,"days")))return;const c=e.find((e=>e.id===t.id));"\u6d17\u8fc7\u4e86"!==(null===c||void 0===c?void 0:c.status)&&v((e=>{let c={};var a,s,n,d;[e.from,e.to].filter((e=>null!==e)).map((e=>e.id)).includes(t.id)?c={...e,from:(null===(a=e.from)||void 0===a?void 0:a.id)===t.id?null:e.from,to:(null===(s=e.to)||void 0===s?void 0:s.id)===t.id?null:e.to}:c=null===e.from?{...e,from:t}:(null===(n=e.from)||void 0===n?void 0:n.id)===t.id?{...e,from:null}:null===e.to?{...e,to:t}:(null===(d=e.to)||void 0===d?void 0:d.id)===t.id?{...e,to:null}:e;return c}))},M=e.find((e=>e.id===d()().format("YYYYMMDD"))),S=n.find((e=>e.id===d()().format("YYYYMMDD"))),k=null===S||void 0===S?void 0:S.person;return O.length?Object(w.jsxs)("div",{className:"App",children:[Object(w.jsxs)(j.a,{align:"middle",children:[Object(w.jsx)(b.a,{xs:24,sm:24,md:24,lg:12,xl:12,children:Object(w.jsx)("img",{src:l,style:{width:"100%"}})}),Object(w.jsx)(b.a,{xs:24,sm:24,md:24,lg:12,xl:12,children:Object(w.jsx)(h.a.Ribbon,{text:d()().format("LL"),children:Object(w.jsxs)(m.a,{vertical:"vertical",justify:"center",align:"center",style:{minHeight:"280px"},children:[Object(w.jsx)(E,{level:4,children:"\u4eca\u5929\u6d17\u8f66\u7684\u662f"}),Object(w.jsx)(E,{children:k}),Object(w.jsx)(D,{loading:c,handleClick:async e=>{try{s(!0);const a=d()().format("YYYYMMDD"),n={date:d()().format("YYYY-MM-DD"),person:k||"",status:e,updatedAt:d()().format("YYYY-MM-DD HH:mm:ss")},l=Object(u.b)(Object(u.a)(x,"calendarMark"),a);await Object(u.e)(l,n),c={id:a,...n},t((e=>{const t=e.findIndex((e=>e.id===c.id));return-1!==t?e.map(((e,a)=>a===t?{...c}:e)):[...e,c]})),console.log("Document written with ID: ",l.id)}catch(a){console.error("Error adding document: ",a)}finally{s(!1)}var c},todayStatus:M})]})})})]}),Object(w.jsxs)("table",{children:[Object(w.jsxs)("thead",{children:[Object(w.jsx)("tr",{children:Object(w.jsxs)("th",{colSpan:7,children:["Days remaining: ",Math.abs(d()().diff(y.end,"days"))]})}),Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:"Sun"}),Object(w.jsx)("th",{children:"Mon"}),Object(w.jsx)("th",{children:"Tue"}),Object(w.jsx)("th",{children:"Wed"}),Object(w.jsx)("th",{children:"Thu"}),Object(w.jsx)("th",{children:"Fri"}),Object(w.jsx)("th",{children:"Sat"})]})]}),Object(w.jsx)("tbody",{children:O.map(((e,t)=>Object(w.jsx)("tr",{children:e.map((e=>{const t=d()(e.date).isSame(d()(),"day")?"active":d()(e.date).isBefore(d()())?"past":"future",c=[p.from,p.to].filter((e=>null!==e)).some((t=>t.id===e.id))?"selected":"";return Object(w.jsx)("td",{className:"".concat(t," ").concat(c),children:Object(w.jsxs)("div",{className:"day",onClick:()=>Y(e),children:[Object(w.jsx)("div",{className:"header",children:d()(e.date).format("MMM DD")}),Object(w.jsx)("div",{className:"icon",children:Object(w.jsx)("img",{src:r})}),Object(w.jsx)("div",{className:"people",children:e.person})]})},e.id)}))},t)))})]}),Object(w.jsx)(N,{selection:p,open:!!p.from||!!p.to,handleRemoveSelection:Y,handleCancel:()=>{v({from:null,to:null})},handleSubmit:()=>{(async(e,t)=>{try{const c=Object(u.b)(x,"calendar",e.id),a=Object(u.b)(x,"calendar",t.id),s={...e,person:t.person},n={...t,person:e.person};console.log("from",{id:e.id,in:e,out:s}),console.log("to",{id:t.id,in:t,out:n}),await Object(u.f)(c,s),await Object(u.f)(a,n),console.log("Documents swapped successfully"),g()}catch(c){console.error("Error swapping documents: ",c)}})(p.from,p.to)}})]}):Object(w.jsx)(o.a,{tip:"Loading..."})}const B=document.getElementById("root");Object(s.createRoot)(B).render(Object(w.jsx)(a.StrictMode,{children:Object(w.jsx)(I,{})}))}},[[133,1,2]]]);
//# sourceMappingURL=main.8b0cccd8.chunk.js.map